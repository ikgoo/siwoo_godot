---
alwaysApply: true
---

# Godot 노드 구조 설계 원칙

## 🚫 금지: 코드 내 동적 노드 생성
코드에서 `add_child()`, `instantiate()` 등으로 노드를 동적으로 생성하는 것을 **최소화**하세요.

### 문제점
1. **시각적 파악 불가**: 게임을 실행해야만 노드 구조를 확인할 수 있음
2. **디버깅 어려움**: 씬 트리에서 실시간으로 노드 구조를 볼 수 없음
3. **유지보수 저하**: 코드를 읽어야만 전체 구조를 이해할 수 있음
4. **협업 비효율**: 다른 개발자가 씬 구조를 직관적으로 파악하기 어려움
5. **Godot 철학 위배**: Godot는 씬 기반 아키텍처를 지향함

## ✅ 권장: .tscn 파일 기반 노드 구조

### 올바른 작업 흐름
1. **씬 파일(.tscn)에서 노드 트리 구성**
   - Godot 에디터에서 노드 추가
   - 계층 구조를 시각적으로 설계
   - 필요한 모든 자식 노드를 미리 배치

2. **스크립트는 기존 노드에 로직만 추가**
   - `@onready var` 로 노드 참조
   - 노드의 동작과 상호작용만 스크립트로 구현
   - 구조는 씬, 로직은 코드로 분리

### 예시

**❌ 나쁜 예시 (코드에서 노드 생성):**
```gdscript
func _ready():
    var label = Label.new()
    label.text = "Score: 0"
    add_child(label)
    
    var sprite = Sprite2D.new()
    sprite.texture = preload("res://icon.png")
    add_child(sprite)
```

**✅ 좋은 예시 (.tscn에 미리 구성):**
```gdscript
# .tscn 파일에 Label, Sprite2D 노드가 이미 존재
@onready var label = $Label
@onready var sprite = $Sprite2D

func _ready():
    label.text = "Score: 0"
    sprite.visible = true
```

## 🎯 예외 상황 (동적 생성 허용)

다음 경우에만 제한적으로 동적 노드 생성을 허용:

1. **인스턴싱이 필수적인 경우**
   - 플레이어가 생성하는 발사체, 적, 아이템 등
   - 런타임에 개수가 결정되는 오브젝트
   - 예: `var bullet = bullet_scene.instantiate()`

2. **절차적 생성**
   - 랜덤 던전, 타일맵 자동 생성
   - 개수를 예측할 수 없는 UI 요소 (채팅 메시지 등)

3. **퍼포먼스 최적화**
   - 오브젝트 풀링 패턴
   - 메모리 관리가 중요한 경우

## 📝 코드 작성 시 체크리스트

AI가 코드를 생성할 때 반드시 확인:
- [ ] 이 노드를 .tscn 파일에 미리 만들 수 있는가?
- [ ] 게임 실행 없이 씬 트리에서 구조를 파악할 수 있는가?
- [ ] 동적 생성이 정말 필수적인가?
- [ ] `@onready var`로 참조하는 구조가 더 명확하지 않은가?

## 🎓 Godot 모범 사례

**"씬은 구조, 스크립트는 동작"** - Godot의 핵심 철학을 따르세요.

- 씬(.tscn): "무엇이 있는가" (What)
- 스크립트(.gd): "어떻게 동작하는가" (How)

이 원칙을 따르면 코드 가독성, 유지보수성, 협업 효율이 크게 향상됩니다.
