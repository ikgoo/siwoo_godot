extends Node

# ========================================
# Signals - ë‹¤ë¥¸ ë…¸ë“œë“¤ì´ êµ¬ë…í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸
# ========================================
signal money_changed(new_amount: int, delta: int)  # ëˆì´ ë³€ê²½ë  ë•Œ (ìƒˆ ê¸ˆì•¡, ë³€í™”ëŸ‰)
signal tier_up(new_tier: int)  # í‹°ì–´ê°€ ì˜¬ë¼ê°ˆ ë•Œ
signal action_text_changed(text: String, visible: bool)  # ì•¡ì…˜ í…ìŠ¤íŠ¸ ë³€ê²½ ì‹œê·¸ë„

func _ready():
	# ì´ˆê¸° í‹°ì–´ ê³„ì‚°
	update_tier()
	max_tier = current_tier
	print("Globals ì´ˆê¸°í™”: money=", money, ", current_tier=", current_tier, ", max_tier=", max_tier)

# ========================================
# ê²Œì„ ë°¸ëŸ°ìŠ¤ ë³€ìˆ˜
# ========================================
var money_up : int = 3  # ì±„êµ´ ì‹œ íšë“í•˜ëŠ” ê¸°ë³¸ ëˆ (ì´ˆë°˜ì„ ëŠë¦¬ê²Œ)
var money_times : float = 100  # ì±„êµ´ ì†ë„ ë°°ìˆ˜
var money_per_second : int = 0  # ì´ˆë‹¹ ìë™ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ëˆ (ì•Œë°” + ê´‘ë¬¼ ì±„êµ´ë¡œ ëˆ„ì )
var money_per_second_upgrade : int = 0  # ì—…ê·¸ë ˆì´ë“œë¡œ ì–»ì€ ì´ˆë‹¹ ëˆ ì¦ê°€ëŸ‰ (ìµœëŒ€ 25, ê´‘ë¬¼ ìº˜ ë•Œë§ˆë‹¤ ì´ ê°’ë§Œí¼ ì¶”ê°€)

# ========================================
# í”¼ë²„ ì‹œìŠ¤í…œ
# ========================================
var fever_multiplier : float = 1.0  # í˜„ì¬ í”¼ë²„ ë°°ìœ¨ (1.0 = ì •ìƒ, 2.0 = 2ë°°)
var is_fever_active : bool = false  # í”¼ë²„ í™œì„±í™” ì—¬ë¶€

# ========================================
# ê²½ì œ ì‹œìŠ¤í…œ
# ========================================
# í”Œë ˆì´ì–´ê°€ ë³´ìœ í•œ ëˆ (ì „ì—­ ë³€ìˆ˜)
var _money : int = 0
var money : int:
	get:
		return _money
	set(value):
		var old_money = _money
		_money = value
		var delta_money = _money - old_money
		
		# Signal ë°œìƒ - UI ì—…ë°ì´íŠ¸ìš©
		money_changed.emit(_money, delta_money)
		
		# í‹°ì–´ ê³„ì‚° (ì´ˆë°˜ ëŠë¦¼ â†’ í›„ë°˜ ë¹Œë“œì—…)
		var old_max_tier = max_tier
		update_tier()
		
		# ìµœëŒ€ í‹°ì–´ ì—…ë°ì´íŠ¸ (í•œë²ˆ ì˜¬ë¼ê°€ë©´ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ) - Signal ë°œìƒ ì „ì— ë¨¼ì €!
		if current_tier > max_tier:
			max_tier = current_tier
			print("âœ¨ ìµœëŒ€ í‹°ì–´ ê°±ì‹ ! ", old_max_tier, " â†’ ", max_tier)
			# ìµœëŒ€ í‹°ì–´ê°€ ê°±ì‹ ë  ë•Œë§Œ Signal ë°œìƒ
			print("ğŸ‰ í‹°ì–´ ìƒìŠ¹! ", old_max_tier, " â†’ ", max_tier, " (ëˆ: ", _money, ")")
			tier_up.emit(max_tier)

# ========================================
# í‹°ì–´ ì‹œìŠ¤í…œ (ë¹Œë“œì—… ëŠë‚Œ)
# ========================================
# í˜„ì¬ í‹°ì–´
var current_tier : int = 0
# ìµœëŒ€ ë‹¬ì„± í‹°ì–´ (í•œë²ˆ ì˜¬ë¼ê°€ë©´ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ)
var max_tier : int = 0

# í‹°ì–´ë³„ í•„ìš” ê¸ˆì•¡ (ì´ˆë°˜ì€ ë¹ ë¥´ê²Œ, í›„ë°˜ì€ ëŠë¦¬ê²Œ)
var tier_thresholds: Array[int] = [
	0,      # í‹°ì–´ 0
	100,    # í‹°ì–´ 1
	200,    # í‹°ì–´ 2 (300 â†’ 200ìœ¼ë¡œ ë‚®ì¶¤)
	400,    # í‹°ì–´ 3 (700 â†’ 400ìœ¼ë¡œ ë‚®ì¶¤)
	800,    # í‹°ì–´ 4 (1500 â†’ 800ìœ¼ë¡œ ë‚®ì¶¤)
	1600,   # í‹°ì–´ 5 (3000 â†’ 1600ìœ¼ë¡œ ë‚®ì¶¤)
	3200,   # í‹°ì–´ 6 (6000 â†’ 3200ìœ¼ë¡œ ë‚®ì¶¤)
	6400,   # í‹°ì–´ 7 (12000 â†’ 6400ìœ¼ë¡œ ë‚®ì¶¤)
	12800,  # í‹°ì–´ 8 (24000 â†’ 12800ìœ¼ë¡œ ë‚®ì¶¤)
	25600   # í‹°ì–´ 9 (48000 â†’ 25600ìœ¼ë¡œ ë‚®ì¶¤)
]

# í˜„ì¬ ëˆìœ¼ë¡œ í‹°ì–´ ê³„ì‚°
func update_tier():
	for i in range(tier_thresholds.size() - 1, -1, -1):
		if _money >= tier_thresholds[i]:
			current_tier = i
			return
	current_tier = 0

# ========================================
# ì—…ê·¸ë ˆì´ë“œ ì‹œìŠ¤í…œ (ë¹Œë“œì—… ê³¡ì„ )
# ========================================
# ì—…ê·¸ë ˆì´ë“œ ë‹¨ê³„ë³„ ì„¤ì •: [í•„ìš” ëˆ, íš¨ê³¼ ì¦ê°€ëŸ‰]
# ì´ˆë°˜ì€ ì €ë ´í•˜ê³  íš¨ê³¼ ì ìŒ â†’ ì¤‘ë°˜ë¶€í„° ë¹„ì‹¸ì§€ì§€ë§Œ íš¨ê³¼ í¼ (ë¹Œë“œì—…)
var upgrade_steps: Array[Vector2i] = [
	Vector2i(30, 2),      # 1ë‹¨ê³„: 30ì›, +2
	Vector2i(80, 3),      # 2ë‹¨ê³„: 80ì›, +3
	Vector2i(200, 5),     # 3ë‹¨ê³„: 200ì›, +5
	Vector2i(500, 8),     # 4ë‹¨ê³„: 500ì›, +8
	Vector2i(1200, 12),   # 5ë‹¨ê³„: 1200ì›, +12
	Vector2i(3000, 20),   # 6ë‹¨ê³„: 3000ì›, +20
	Vector2i(7000, 35),   # 7ë‹¨ê³„: 7000ì›, +35
	Vector2i(15000, 60),  # 8ë‹¨ê³„: 15000ì›, +60
	Vector2i(35000, 100), # 9ë‹¨ê³„: 35000ì›, +100
	Vector2i(80000, 200)  # 10ë‹¨ê³„: 80000ì›, +200
]

# ========================================
# ì°¸ì¡°
# ========================================
# í”Œë ˆì´ì–´ ìºë¦­í„° ì°¸ì¡° (ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
var player = null

# ========================================
# ì•¡ì…˜ í…ìŠ¤íŠ¸ ì‹œìŠ¤í…œ
# ========================================
# ì•¡ì…˜ í…ìŠ¤íŠ¸ í‘œì‹œ
func show_action_text(text: String):
	action_text_changed.emit(text, true)

# ì•¡ì…˜ í…ìŠ¤íŠ¸ ìˆ¨ê¹€
func hide_action_text():
	action_text_changed.emit("", false)
