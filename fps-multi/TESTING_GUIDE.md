# 멀티플레이어 테스트 가이드

## 로컬 테스트 (같은 컴퓨터에서)

### 1. 게임 내보내기
1. Godot 에디터에서 **프로젝트 → 내보내기** 선택
2. Windows Desktop 프리셋 추가
3. **내보내기** 버튼 클릭하여 exe 파일 생성

### 2. 서버와 클라이언트 실행
1. **내보낸 exe 파일** 실행 (클라이언트 1)
2. **Godot 에디터에서 플레이** 버튼 클릭 (클라이언트 2)

### 3. 테스트 시나리오

#### 옵션 A: EXE가 서버
1. EXE: **서버 생성** → 이름 입력 → 생성
2. 에디터: **서버 참가** → IP: `127.0.0.1` → 참가
3. 에디터: 로비에서 **준비** 클릭
4. EXE: **게임 시작** 클릭

#### 옵션 B: 에디터가 서버
1. 에디터: **서버 생성** → 이름 입력 → 생성
2. EXE: **서버 참가** → IP: `127.0.0.1` → 참가
3. EXE: 로비에서 **준비** 클릭
4. 에디터: **게임 시작** 클릭

## 네트워크 테스트 (다른 컴퓨터)

### 준비사항

#### 호스트 (서버 실행할 사람)
1. **로컬 IP 확인**:
   - Windows: `cmd` 열고 `ipconfig` 실행
   - IPv4 주소 확인 (예: 192.168.0.5)

2. **방화벽 설정**:
   - Windows Defender 방화벽 → 고급 설정
   - 인바운드 규칙 → 새 규칙
   - 포트 → UDP → 7777 → 허용
   - 이름: "FPS Multiplayer"

3. **포트 포워딩** (인터넷 플레이 시):
   - 라우터 설정 페이지 접속 (보통 192.168.0.1 또는 192.168.1.1)
   - 포트 포워딩/가상 서버 메뉴 찾기
   - 설정:
     - 외부 포트: 7777
     - 내부 IP: 자신의 로컬 IP
     - 내부 포트: 7777
     - 프로토콜: UDP
   - 저장 및 재부팅

#### 클라이언트 (참가할 사람)
1. 호스트에게 IP 주소 받기
   - 같은 Wi-Fi: 로컬 IP (192.168.x.x)
   - 인터넷: 공인 IP (whatismyip.com에서 확인)

### 테스트 절차

1. **호스트**:
   - 게임 실행
   - **서버 생성**
   - 서버 이름 입력
   - UPNP 사용 체크 (권장)
   - 생성 클릭

2. **클라이언트**:
   - 게임 실행
   - **서버 참가**
   - IP: 호스트의 IP 주소 입력
   - 포트: 7777
   - 참가 클릭

3. **로비에서**:
   - 클라이언트: **준비** 클릭
   - 호스트: 모두 준비되면 **게임 시작**

## 문제 해결

### "서버 생성 실패: 포트 7777이 이미 사용 중"
- 다른 프로그램이 포트를 사용 중
- 해결:
  1. 서버 생성 UI에서 포트를 7778로 변경
  2. 또는 다른 프로그램 종료

### "서버 접속 실패"
확인사항:
- [ ] IP 주소가 정확한가?
- [ ] 포트 번호가 일치하는가?
- [ ] 호스트의 방화벽이 7777 UDP를 허용하는가?
- [ ] 같은 네트워크인가? (Wi-Fi)
- [ ] 포트 포워딩 설정이 올바른가? (인터넷)

### UPNP가 작동하지 않음
- 라우터가 UPNP를 지원하지 않을 수 있음
- 해결: 수동 포트 포워딩 사용

### 게임에 접속했지만 다른 플레이어가 안 보임
- 게임 재시작
- 서버 재생성

### 랙/지연 발생
- 인터넷 연결 상태 확인
- 핑이 높은 경우 지연 발생 가능
- 호스트의 업로드 속도가 충분한지 확인

## 테스트 체크리스트

### 로비 테스트
- [ ] 서버 생성 성공
- [ ] 클라이언트 접속 성공
- [ ] 플레이어 목록에 모두 표시됨
- [ ] 준비 버튼 작동
- [ ] 게임 시작 버튼 작동 (호스트만)

### 게임플레이 테스트
- [ ] 모든 플레이어가 스폰됨
- [ ] 이름 태그가 표시됨
- [ ] 다른 플레이어 이동이 보임
- [ ] 총 발사가 동기화됨
- [ ] 데미지가 올바르게 적용됨
- [ ] 무기 교체가 보임
- [ ] HP가 동기화됨

### 성능 테스트
- [ ] FPS가 60 이상 유지됨
- [ ] 이동이 부드러움
- [ ] 총 발사가 즉각 반응함
- [ ] 지연(랙)이 없음

## 디버깅 팁

### 콘솔 로그 확인
게임 실행 시 출력되는 로그:
```
서버 생성 성공! 포트: 7777
플레이어 연결: 2
로비: 플레이어 2 연결
게임 시작!
```

### 에디터에서 디버깅
1. 에디터에서 플레이하면 Output 탭에서 로그 확인 가능
2. Remote 탭에서 씬 트리 확인
3. Debugger 탭에서 네트워크 상태 확인

### 네트워크 도구
- **포트 스캔**: `netstat -an | findstr 7777` (Windows)
- **외부 IP 확인**: whatismyip.com
- **포트 체크**: canyouseeme.org

## 성공 기준

✅ 2명 이상이 동시에 게임 플레이 가능  
✅ 실시간 위치 동기화  
✅ 무기 발사 동기화  
✅ 데미지/HP 동기화  
✅ 부드러운 플레이 (60 FPS)  

## 추가 테스트

### 3-4명 테스트
1. 여러 대의 컴퓨터 필요
2. 모두 같은 방법으로 접속
3. 성능 확인

### 연결 해제 테스트
1. 게임 중 한 플레이어 연결 끊기
2. 다른 플레이어들은 계속 플레이 가능해야 함

### 재접속 테스트
1. 연결 끊긴 플레이어 다시 접속
2. 정상적으로 게임 참여 가능해야 함

---

**Happy Testing! 🎮**

